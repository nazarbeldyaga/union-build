<!DOCTYPE html>
<html>
<head>
  <title>Union Build Daily Transfer Count</title>
  <link rel="stylesheet" href="/stylesheets/styles.css">
  <!-- Подключаем Chart.js через CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<h1>Union Build Daily Transfer Count</h1>

<!-- График: Количество транзакций по дням -->
<h2>Daily Transactions and Cumulative Total</h2>
<canvas id="transferCountChart" width="800" height="400"></canvas>

<script>
  // Данные для графика
  const chartData = <%- chartData %>;

  // Переворачиваем данные, чтобы последние даты были справа
  const reversedData = chartData.slice().reverse();

  // Вычисляем кумулятивную сумму
  const cumulativeData = reversedData.map((item, index) => {
    return {
      date: item.date,
      count: item.count,
      total: reversedData.slice(0, index + 1).reduce((sum, d) => sum + d.count, 0)
    };
  });

  // График: Количество транзакций по дням и общая сумма
  const ctx = document.getElementById('transferCountChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: cumulativeData.map(item => item.date), // Даты в обратном порядке
      datasets: [
        {
          label: 'Daily Transactions',
          data: cumulativeData.map(item => item.count),
          fill: false,
          borderColor: 'rgba(75, 192, 192, 1)',
          tension: 0.1
        },
        {
          label: 'Cumulative Total Transfers',
          data: cumulativeData.map(item => item.total),
          fill: false,
          borderColor: 'rgba(255, 99, 132, 1)',
          tension: 0.1
        }
      ]
    },
    options: {
      scales: {
        x: {
          title: { display: true, text: 'Date' },
          ticks: {
            maxRotation: 45,
            minRotation: 45
          }
        },
        y: {
          title: { display: true, text: 'Number of Transactions' },
          beginAtZero: true
        }
      },
      plugins: {
        legend: {
          display: true
        }
      }
    }
  });
</script>
</body>
</html>